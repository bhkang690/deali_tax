<!doctype html>
<html>
    <head>
        <title>Convert API snippet</title>
        <style>
        #loading{
        display:none;
        }

        #loading .loader {
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 2000;
            margin: -75px 0 0 -60px;
            border: 16px solid rgb(244, 244, 244, 0.3);
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        #loading .overay{
          position:fixed;
            width:100vw;
            height:100vh;
            background:rgba(0,0,0,0.5);
            z-index:1100;
            display:block;
            top:0;
            left:0;
        }
        </style>

        <div id="loading">
            <div class="loader fade-in"></div>
            <div class="overay"></div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript">
            function getParameter(name) {
                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
                return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
            }

            var pdfPath = getParameter("path");
            $(document).ready(function() {
                $('#File').val(pdfPath);
               var formData = $("#convertapiForm").serialize();
                $("#loading").show();
                $.ajax({
                    cache : false,
                    url : "https://v2.convertapi.com/convert/pdf/to/jpg?Secret=ARqASJ2y8g0EL9Yl&download=attachment",
                    type : 'POST', 
                    data : formData,
                    xhr:function(){// Seems like the only way to get access to the xhr object
                        var xhr = new XMLHttpRequest();
                        xhr.responseType= 'blob'
                        return xhr;
                    },
                    success : function(data, xhr) {
                        var img = document.getElementById('img');
                        var url = window.URL || window.webkitURL;
                        img.src = url.createObjectURL(data);
                        img.download = url.createObjectURL(data);

                        $("#loading").hide();
                    }, // success 

                    error : function(xhr, status) {
                        alert(xhr + " : " + status);
                        $("#loading").hide();
                    }
                })
                .done(function (blob, status, xhr) {
                    // check for a filename
                    var fileName = "";
                    var disposition = xhr.getResponseHeader("Content-Disposition");

                    if (disposition && disposition.indexOf("attachment") !== -1) {
                        var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                        var matches = filenameRegex.exec(disposition);

                        if (matches != null && matches[1]) {
                            fileName = decodeURI(matches[1].replace(/['"]/g, "")) + ".jpg";
                        }
                    }

                    // for IE
                    if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                        window.navigator.msSaveOrOpenBlob(blob, fileName);
                    } else {
                        var URL = window.URL || window.webkitURL;
                        var downloadUrl = URL.createObjectURL(blob);

                        if (fileName) {
                            var a = document.createElement("a");

                            // for safari
                            if (a.download === undefined) {
                                window.location.href = downloadUrl;
                            } else {
                                a.href = downloadUrl;
                                a.download = fileName;
                                document.body.appendChild(a);
                                a.click();
                            }
                        } else {
                            window.location.href = downloadUrl;
                        }
                    }
                });
                
            });
        </script>
    </head>
    <body>
        <img id="img" width="100%">
        <form action="https://v2.convertapi.com/convert/pdf/to/jpg?Secret=ARqASJ2y8g0EL9Yl&download=attachment" id="convertapiForm" method="post" enctype="multipart/form-data">
            <input type="hidden" id="File" name="File" value="https://payment-s3-settlement.sinsang.market/2022/04/individual_pdf/sinsangmarket/d8c51be39ea8e12fa093677f836046a91871b87997acc63c581c86a48e21178b/2022%EB%85%8404%EC%9B%94%EB%8F%84%EB%A7%A4%EC%84%B8%EA%B8%88%EA%B3%84%EC%82%B0%EC%84%9C.pdf"/>
        </form>
    </body>
</html>
